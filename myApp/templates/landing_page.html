<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>NeuroMed Aira ‚Äî Medical Results Explained Simply</title>
  <link rel="manifest" href="/static/pwa/manifest.webmanifest">
  <link rel="apple-touch-icon" href="https://res.cloudinary.com/dk52yeq9x/image/upload/v1768919639/NeuroMed_AI_Logo-13-12_vgfarp.png">
  <link rel="icon" type="image/png" sizes="32x32" href="https://res.cloudinary.com/dk52yeq9x/image/upload/v1768919639/NeuroMed_AI_Logo-13-12_vgfarp.png">
  <link rel="icon" type="image/png" sizes="16x16" href="https://res.cloudinary.com/dk52yeq9x/image/upload/v1768919639/NeuroMed_AI_Logo-13-12_vgfarp.png">
  <meta name="theme-color" content="#236092">

  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/dompurify@3.1.6/dist/purify.min.js"></script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet"/>

<style>
/* ===== Markdown Styles ===== */
.chat-ai.chat-bubble { white-space: normal; line-height: 1.40; padding: 10px 12px; }
.chat-ai .md-prose { font-size: .98rem; line-height: 1.40; }
.chat-ai .md-prose > :first-child { margin-top: 0 !important; }
.chat-ai .md-prose > :last-child { margin-bottom: 0 !important; }
.chat-ai .md-prose h1, .chat-ai .md-prose h2, .chat-ai .md-prose h3, .chat-ai .md-prose h4 { 
  margin: .22em 0 .14em !important; line-height: 1.18; 
}
.chat-ai .md-prose h1 { font-size: 1.18rem; }
.chat-ai .md-prose h2 { font-size: 1.08rem; }
.chat-ai .md-prose h3 { font-size: 1.02rem; }
.chat-ai .md-prose h4 { font-size: .98rem; }
.chat-ai .md-prose p { margin: .12em 0 !important; }
.chat-ai .md-prose p + p { margin-top: .10em !important; }
.chat-ai .md-prose p:empty { display: none; }
.chat-ai .md-prose :is(h1,h2,h3,h4) + :is(p,ul,ol,table,blockquote) { margin-top: .16em !important; }
.chat-ai .md-prose :is(p,ul,ol,table,blockquote) + :is(h1,h2,h3,h4) { margin-top: .24em !important; }
.chat-ai .md-prose ul, .chat-ai .md-prose ol { margin: .14em 0 .2em 1em !important; }
.chat-ai .md-prose li { margin: .04em 0 !important; }
.chat-ai .md-prose blockquote {
  border-left: 2px solid #e2e8f0;
  padding-left: .45rem;
  margin: .18em 0 !important;
  color: #475569;
}
.chat-ai .md-prose code { background:#0f172a0d; padding:.04rem .18rem; border-radius:.3rem; }
.chat-ai .md-prose pre { background:#0f172a0d; padding:.5rem; border-radius:.6rem; margin:.22rem 0 !important; }
.chat-ai .md-prose table { width:100%; border-collapse: collapse; margin:.22rem 0 !important; font-size:.93rem; }
.chat-ai .md-prose th, .chat-ai .md-prose td { border:1px solid #e2e8f0; padding:.28rem .4rem; }
.chat-ai .md-prose thead th { background:#f8fafc; }

/* ===== Base 44 Inspired Design ===== */
:root{
  --brand:#236092;
  --brand-dark:#1B4A7A;
  --accent-orange:#F59E0B;
  --gradient-bg: linear-gradient(135deg, #e0f2fe 0%, #bae6fd 25%, #fef3c7 50%, #fde68a 100%);
}

html{ font-size: 16px; }
body{ 
  background: var(--gradient-bg);
  background-attachment: fixed;
  min-height: 100vh;
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
}

.chat-bubble{
  border-radius: 18px;
  padding: 12px 16px;
  line-height: 1.55;
  box-shadow: 0 1px 4px rgba(0,0,0,.04);
  max-width: 80%;
  white-space: pre-wrap;
  word-break: break-word;
  font-size: 1.05rem;
}
@media (min-width:640px){ .chat-bubble{ max-width: 68ch; } }
.chat-user{ 
  background:#0f172a; 
  color:#fff; 
  border-bottom-right-radius:6px!important; 
  margin-left:auto;
}
.chat-ai{ 
  background:#ffffff; 
  color:#111827; 
  border:1px solid rgba(0,0,0,.05); 
  border-bottom-left-radius:6px!important; 
  margin-right:auto;
}

.pulse{ animation:pulse 1.1s ease-in-out infinite; }
@keyframes pulse{ 0%,100%{opacity:.55} 50%{opacity:1} }

.toast{
  transform:translateY(-10px);
  opacity:0;
  transition:transform .2s ease,opacity .2s ease;
}
.toast.show{
  transform:translateY(0);
  opacity:1;
}

.shimmer{
  position:relative;
  overflow:hidden;
}
.shimmer::after{
  content:"";
  position:absolute;
  inset:0;
  background:linear-gradient(90deg,rgba(255,255,255,0) 0%,rgba(255,255,255,.7) 50%,rgba(255,255,255,0) 100%);
  transform:translateX(-100%);
  animation:shimmer 900ms ease forwards;
}
@keyframes shimmer{ to{transform:translateX(100%)} }

.is-disabled{ opacity:.5; pointer-events:none; }

/* Modern Input Field */
.main-input-wrapper {
  position: relative;
  max-width: 800px;
  margin: 0 auto;
}

.main-input {
  width: 100%;
  padding: 20px 72px 20px 24px;
  font-size: 1.1rem;
  border: 2px solid rgba(0,0,0,.08);
  border-radius: 16px;
  background: white;
  box-shadow: 0 4px 20px rgba(0,0,0,.08);
}

.main-input:focus {
  outline: none;
  border-color: var(--brand);
  box-shadow: 0 4px 24px rgba(35,96,146,.15);
}

.send-button-main {
  position: absolute;
  right: 12px;
  top: 50%;
  transform: translateY(-50%);
  width: 48px;
  height: 48px;
  border-radius: 12px;
  background: var(--accent-orange);
  border: none;
  color: white;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
}

.send-button-main:hover:not(:disabled) {
  background: #d97706;
}

.send-button-main:disabled {
  opacity: 0.4;
  cursor: not-allowed;
}

.suggestion-chip {
  display: inline-flex;
  align-items: center;
  gap: 8px;
  padding: 12px 20px;
  background: white;
  border: 1px solid rgba(0,0,0,.08);
  border-radius: 12px;
  font-size: 0.95rem;
  cursor: pointer;
  transition: all 0.2s ease;
  box-shadow: 0 2px 8px rgba(0,0,0,.04);
}

.suggestion-chip:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(0,0,0,.1);
  border-color: var(--brand);
}

.mode-selector {
  display: inline-flex;
  align-items: center;
  gap: 8px;
  padding: 10px 18px;
  background: white;
  border: 1px solid rgba(0,0,0,.08);
  border-radius: 12px;
  font-size: 0.9rem;
  font-weight: 500;
  cursor: pointer;
  transition: all 0.2s ease;
  color: #1e293b;
}

.mode-selector:hover:not([aria-pressed="true"]) {
  border-color: var(--brand);
  box-shadow: 0 2px 8px rgba(0,0,0,.08);
}

.mode-selector[aria-pressed="true"] {
  background: var(--brand);
  color: white;
  border-color: var(--brand);
  box-shadow: 0 2px 8px rgba(35,96,146,.2);
}

.mode-selector[aria-pressed="true"] i {
  color: white !important;
}

@media (max-width: 767px){
  .main-input { padding: 16px 60px 16px 20px; font-size: 1rem; }
  .send-button-main { width: 44px; height: 44px; }
  .suggestion-chip { padding: 10px 16px; font-size: 0.9rem; }
}
</style>

</head>
<body class="text-slate-800">
  <!-- Navigation Bar -->
  <header class="w-full border-b border-white/20 bg-white/80 backdrop-blur-md shadow-sm sticky top-0 z-50">
    <div class="max-w-7xl mx-auto px-5 py-4 flex items-center justify-between">
      <!-- Logo -->
      <a href="/" class="flex items-center gap-3">
  <img src="https://res.cloudinary.com/djzks0atj/image/upload/v1759412135/NeuroMed_AI_Logo-10_yassi6.png" 
       alt="NeuroMed Aira Logo" 
       class="h-8 object-contain"/>
</a>

      <!-- Desktop Navigation -->
      <div class="hidden md:flex items-center gap-6">
        <button id="fontMinus" class="px-3 py-1.5 rounded-lg border border-slate-200 hover:bg-slate-50 text-sm" title="Smaller">A‚àí</button>
        <button id="fontPlus" class="px-3 py-1.5 rounded-lg border border-slate-200 hover:bg-slate-50 text-sm" title="Larger">AÔºã</button>
        <button id="highContrast" class="px-3 py-1.5 rounded-lg border border-slate-200 hover:bg-slate-50 text-sm" aria-pressed="false" title="High contrast">Contrast</button>
        <a href="/signup" class="text-slate-700 hover:text-slate-900 text-sm font-medium">Sign up</a>
        <a href="/login" class="px-4 py-2 rounded-lg bg-slate-900 text-white hover:bg-slate-800 text-sm font-medium transition">Log in</a>
        <!-- Language Picker -->
<div class="relative">
          <button id="langBtn" class="px-3 py-1.5 rounded-lg border border-slate-200 hover:bg-slate-50 flex items-center gap-2 text-sm" aria-haspopup="menu" aria-expanded="false">
            <i class="fa-solid fa-globe text-sm"></i>
    <span id="langBtnLabel">English</span>
            <i class="fa-solid fa-caret-down opacity-70 text-xs"></i>
  </button>
          <div id="langMenu" class="hidden absolute right-0 mt-2 w-56 max-h-72 overflow-auto bg-white border rounded-xl shadow-lg z-50"></div>
  </div>
</div>

      <!-- Mobile Menu Button -->
      <button id="nmMenuBtn" class="md:hidden inline-flex items-center justify-center rounded-lg p-2 border border-slate-200 text-slate-700 hover:bg-slate-50" aria-label="Open menu">
        <svg id="nmIconOpen" class="h-5 w-5" viewBox="0 0 24 24" fill="none" stroke="currentColor">
          <path stroke-width="2" stroke-linecap="round" d="M4 7h16M4 12h16M4 17h16"/>
        </svg>
        <svg id="nmIconClose" class="h-5 w-5 hidden" viewBox="0 0 24 24" fill="none" stroke="currentColor">
          <path stroke-width="2" stroke-linecap="round" d="M6 6l12 12M18 6l-12 12"/>
        </svg>
      </button>
    </div>

    <!-- Mobile Menu -->
    <div id="nmMobileMenu" class="md:hidden hidden border-t bg-white/95 backdrop-blur">
      <div class="max-w-7xl mx-auto px-5 py-4 grid gap-3">
        <div class="flex items-center gap-2">
          <button id="mFontMinus" class="px-3 py-2 rounded-lg border w-full text-sm">A‚àí</button>
          <button id="mFontPlus" class="px-3 py-2 rounded-lg border w-full text-sm">AÔºã</button>
          <button id="mHighContrast" class="px-3 py-2 rounded-lg border w-full text-sm" aria-pressed="false">Contrast</button>
        </div>
        <div class="flex items-center gap-2">
          <a href="/signup" class="flex-1 text-center rounded-lg px-4 py-2 border hover:bg-slate-50 text-sm">Sign up</a>
          <a href="/login" class="flex-1 text-center rounded-lg px-4 py-2 border hover:bg-slate-50 text-sm">Log in</a>
        </div>
<div class="grid gap-2">
          <button id="mLangBtn" class="px-3 py-2 rounded-lg border w-full flex items-center justify-between text-sm">
    <span class="flex items-center gap-2">
      <i class="fa-solid fa-globe"></i>
      <span id="mLangBtnLabel">English</span>
    </span>
    <i class="fa-solid fa-caret-down opacity-70"></i>
  </button>
          <div id="mLangMenu" class="hidden border rounded-xl bg-white shadow-lg max-h-72 overflow-auto"></div>
  </div>
      </div>
    </div>
  </header>

  <!-- Main Content -->
  <main class="max-w-7xl mx-auto px-4 md:px-6 pt-12 md:pt-20 pb-16">
    <!-- Hero Section -->
    <div class="text-center mb-12 relative">
      <!-- Decorative accent elements -->
      <div class="absolute top-0 left-1/2 -translate-x-1/2 -translate-y-8 w-32 h-1 bg-gradient-to-r from-transparent via-[#236092] to-transparent opacity-30"></div>
      
      <div class="relative inline-block mb-8">
        <!-- Trust badge/icon accent -->
        <div class="absolute -top-4 -right-4 w-16 h-16 bg-gradient-to-br from-[#236092]/10 to-amber-200/20 rounded-full blur-xl"></div>
        <div class="relative bg-white/60 backdrop-blur-sm border border-slate-200/50 rounded-2xl px-6 py-3 shadow-lg inline-flex items-center gap-3 mb-6">
          <div class="w-10 h-10 rounded-xl bg-gradient-to-br from-[#236092] to-[#1B5A8E] flex items-center justify-center shadow-md">
            <i class="fa-solid fa-shield-halved text-white text-sm"></i>
          </div>
          <div class="text-left">
            <p class="text-xs font-semibold text-slate-900">HIPAA-Compliant</p>
            <p class="text-xs text-slate-600">Medical-grade security</p>
          </div>
        </div>
      </div>
      
      <h1 class="text-4xl md:text-5xl lg:text-6xl font-bold tracking-tight text-slate-900 mb-6 max-w-4xl mx-auto leading-tight relative">
        <span class="relative inline-block">
          Medical results,<br>
          <span class="bg-gradient-to-r from-[#236092] via-[#1B5A8E] to-[#236092] bg-clip-text text-transparent">explained with care.</span>
          <div class="absolute -bottom-2 left-0 right-0 h-1 bg-gradient-to-r from-transparent via-[#236092]/20 to-transparent"></div>
        </span>
      </h1>
      
      <div class="max-w-3xl mx-auto space-y-4 mb-8">
        <p class="text-xl md:text-2xl text-slate-700 max-w-3xl mx-auto leading-relaxed">
          Meet <span class="font-semibold text-[#236092]">Aira</span> ‚Äî a compassionate medical AI designed to help you understand your health without confusion or overwhelm.
        </p>
        <p class="text-lg md:text-xl text-slate-600 max-w-3xl mx-auto leading-relaxed">
          Upload a medical document and talk it through with Aira in plain language. You'll get clear explanations, thoughtful next steps, and a calm space to ask questions ‚Äî at your own pace.
        </p>
      </div>
      
      <!-- Visual separator with accent -->
      <div class="flex items-center justify-center gap-4 mb-8 max-w-2xl mx-auto">
        <div class="flex-1 h-px bg-gradient-to-r from-transparent via-slate-300 to-transparent"></div>
        <div class="w-2 h-2 rounded-full bg-[#236092] opacity-60"></div>
        <div class="flex-1 h-px bg-gradient-to-r from-transparent via-slate-300 to-transparent"></div>
      </div>
      
      <!-- Mode Selector -->
      <div class="flex items-center justify-center gap-3 mb-8">
        <span class="text-sm text-slate-600">How Aira responds:</span>
        <div id="modeSelectWrap" class="flex items-center gap-2 flex-wrap justify-center">
          <button data-mode="PlainClinical" class="mode-selector" aria-pressed="true">
            <i class="fa-regular fa-message text-[#236092]"></i>
            <span>Balanced</span>
        </button>
          <button data-mode="Caregiver" class="mode-selector" aria-pressed="false">
            <i class="fa-solid fa-hands-holding-child text-amber-700"></i>
            <span>Caregiver</span>
    </button>
          <button data-mode="Clinical" class="mode-selector" aria-pressed="false">
            <i class="fa-solid fa-stethoscope text-slate-800"></i>
            <span>Clinical</span>
    </button>
          <button data-mode="Faith" class="mode-selector" aria-pressed="false">
            <i class="fa-solid fa-hands-praying text-indigo-700"></i>
            <span>Faith</span>
    </button>
          <button data-mode="Geriatric" class="mode-selector" aria-pressed="false">
            <i class="fa-solid fa-person-cane text-[#28926D]"></i>
            <span>Geriatric</span>
    </button>
          <button data-mode="EmotionalSupport" class="mode-selector" aria-pressed="false">
            <i class="fa-solid fa-heart text-rose-700"></i>
            <span>Emotional Support</span>
    </button>
        </div>
        </div>
      </div>
      
    <!-- Intro Message -->
    <div class="max-w-4xl mx-auto mb-8">
      <div class="w-full flex">
        <div id="intro" class="chat-bubble chat-ai shimmer mr-auto">
          <p class="text-slate-800 leading-relaxed">
            Hi there! You're in Balanced Mode. I can help you with clear explanations and add clinician notes when useful.
          </p>
        </div>
      </div>
    </div>

    <!-- Chat Window -->
    <div id="chatWindow" class="max-w-4xl mx-auto mb-6 space-y-4 min-h-[100px]"></div>

    <!-- Main Input Field -->
    <div class="main-input-wrapper mb-8">
      <input 
        type="file" 
        id="fileInput" 
        class="hidden" 
        accept=".pdf,.doc,.docx,.txt,.jpg,.jpeg,.png,.heic,.webp" 
        multiple 
      />
      <div class="relative">
        <textarea 
          id="chatInput" 
          class="main-input" 
          rows="1" 
          placeholder="Type your question or upload a medical document..."
          aria-label="Message"
        ></textarea>
        <div class="absolute right-[68px] top-1/2 -translate-y-1/2 flex items-center gap-2 z-10">
          <button id="uploadBtn" class="w-10 h-10 rounded-lg bg-slate-100 hover:bg-slate-200 flex items-center justify-center" title="Upload file">
            <i class="fa-solid fa-paperclip text-slate-600"></i>
          </button>
          <button id="micBtn" class="w-10 h-10 rounded-lg bg-slate-100 hover:bg-slate-200 flex items-center justify-center" title="Voice input">
            <i class="fa-solid fa-microphone text-slate-600"></i>
    </button>
        </div>
        <button id="sendBtn" class="send-button-main z-10" title="Send" aria-label="Send" disabled>
          <i class="fa-solid fa-arrow-up"></i>
  </button>
        <div id="fileChips" class="absolute -bottom-8 left-0 flex flex-wrap gap-2 mt-2"></div>
        </div>
      </div>
      
    <!-- Suggestions -->
    <div class="text-center mb-8">
      <p class="text-sm text-slate-600 mb-4">Not sure where to start? Try one of these:</p>
      <div id="suggestionsList" class="flex flex-wrap items-center justify-center gap-3">
        <button class="suggestion-chip" role="listitem">
          <i class="fa-regular fa-hospital text-[#236092]"></i>
          <span>Simplify this ER discharge for my family</span>
        </button>
        <button class="suggestion-chip" role="listitem">
          <i class="fa-solid fa-vial-circle-check text-[#236092]"></i>
          <span>Explain these labs in plain English</span>
        </button>
        <button class="suggestion-chip" role="listitem">
          <i class="fa-solid fa-pills text-[#236092]"></i>
          <span>Make a daily medication schedule</span>
        </button>
        <button class="suggestion-chip" role="listitem">
          <i class="fa-regular fa-clipboard text-[#236092]"></i>
          <span>Questions to ask my doctor</span>
        </button>
        <button class="suggestion-chip" role="listitem">
          <i class="fa-solid fa-language text-[#236092]"></i>
          <span>Translate this for my lola (Taglish)</span>
        </button>
      </div>
    </div>
  </main>

  <!-- Product Intro Section -->
 <!-- Two Panel Section: Product Demo -->
<section class="py-28 bg-white">
  <div class="max-w-7xl mx-auto px-6">

    <!-- Header -->
    <div class="text-center mb-20">
      <h2 class="text-4xl md:text-5xl font-bold text-slate-900 mb-5">
        Medical information, finally explained clearly
      </h2>
      <p class="text-lg text-slate-600 max-w-2xl mx-auto">
        Aira helps you understand medical results without pressure, jargon, or overwhelm.
      </p>
    </div>

    <div class="grid lg:grid-cols-2 gap-20 items-center">

      <!-- LEFT: Narrative Panel -->
      <div class="space-y-12">

        <!-- Quote / Use Case -->
        <div class="relative bg-slate-50 rounded-3xl p-10">
          <span class="absolute -top-4 left-8 text-xs font-semibold tracking-wide text-slate-400 bg-white px-3 py-1 rounded-full border">
            Real question
          </span>
          <p class="text-xl text-slate-800 italic leading-relaxed mb-4">
            ‚ÄúExplain this lab result in simple terms for my elderly mother.‚Äù
          </p>
          <p class="text-sm text-slate-600 max-w-md">
            Speak naturally. Aira understands context, intent, and emotional weight ‚Äî without you explaining how.
          </p>
        </div>

        <!-- Feature Card -->
        <div class="bg-white rounded-3xl border border-slate-200 p-10 space-y-6 shadow-sm">
          <div class="flex gap-4">
            <div class="w-10 h-10 rounded-xl bg-[#236092]/10 text-[#236092] flex items-center justify-center">
              <i class="fa-solid fa-brain"></i>
            </div>
            <div>
              <h3 class="font-semibold text-slate-900 mb-1">
                Understand instantly
              </h3>
              <p class="text-sm text-slate-600">
                Aira translates complex medical language into calm, human explanations.
              </p>
            </div>
          </div>

          <div class="flex gap-4">
            <div class="w-10 h-10 rounded-xl bg-[#236092]/10 text-[#236092] flex items-center justify-center">
              <i class="fa-solid fa-wand-magic-sparkles"></i>
            </div>
            <div>
              <h3 class="font-semibold text-slate-900 mb-1">
                Adapts automatically
              </h3>
              <p class="text-sm text-slate-600">
                No modes to choose. Aira quietly adjusts how it explains based on you.
              </p>
            </div>
          </div>
        </div>
      </div>

      <!-- RIGHT: Demo UI -->
      <div class="relative">

        <!-- Soft background glow -->
        <div class="absolute -inset-8 rounded-3xl bg-gradient-to-tr from-[#236092]/10 via-transparent to-amber-200/30 blur-3xl"></div>

        <div class="relative bg-white rounded-3xl shadow-2xl border border-slate-200 p-8">

          <!-- App Header -->
          <div class="flex items-center gap-3 mb-8">
            <div class="w-10 h-10 rounded-xl border border-slate-200 flex items-center justify-center">
              <img
                src="https://res.cloudinary.com/dk52yeq9x/image/upload/v1768919639/NeuroMed_AI_Logo-13-12_vgfarp.png"
                class="w-6 h-6"
              />
            </div>
            <div>
              <p class="font-semibold text-slate-900">NeuroMed Aira</p>
              <p class="text-xs text-slate-500">Medical Summary Assistant</p>
            </div>
          </div>

          <!-- Input -->
          <div class="bg-slate-50 rounded-2xl p-6 mb-6">
            <p class="text-sm text-slate-700 mb-4">
              Explain this lab result in simple terms for my elderly mother
            </p>

            <div class="flex justify-end">
              <button class="w-11 h-11 rounded-xl bg-[#F59E0B] hover:bg-[#d97706] flex items-center justify-center shadow-md transition">
                <i class="fa-solid fa-arrow-up text-white"></i>
              </button>
            </div>
          </div>

          <!-- Output -->
          <div class="space-y-4">
            <div class="bg-white rounded-xl p-4 border border-slate-100">
              <p class="text-xs font-semibold text-slate-900 mb-1">In simple terms</p>
              <p class="text-sm text-slate-600">
                Your results are normal. No immediate concerns.
              </p>
            </div>

            <div class="grid grid-cols-2 gap-3">
              <div class="bg-slate-50 rounded-xl p-3">
                <p class="text-xs font-semibold text-slate-900 mb-1">What this means</p>
                <p class="text-xs text-slate-600">Everything looks stable.</p>
              </div>
              <div class="bg-slate-50 rounded-xl p-3">
                <p class="text-xs font-semibold text-slate-900 mb-1">Next steps</p>
                <p class="text-xs text-slate-600">Continue routine care.</p>
              </div>
            </div>
          </div>

        </div>
      </div>

    </div>
  </div>
</section>


<!-- Two Panel Section: Product Demo -->



  <!-- Backend Built-in Section -->
  <section class="py-28 bg-gradient-to-b from-slate-50 to-white">
    <div class="max-w-7xl mx-auto px-6">
      <div class="grid lg:grid-cols-2 gap-20 items-center">
  
        <!-- LEFT: Secure System Visual -->
        <div class="relative order-2 lg:order-1">
  
          <!-- Soft glow -->
          <div class="absolute -inset-8 rounded-3xl bg-gradient-to-tr from-blue-200/20 via-transparent to-emerald-200/20 blur-3xl"></div>
  
          <div class="relative bg-white rounded-3xl shadow-2xl border border-slate-200 p-8 space-y-8">
  
            <!-- Status Header -->
            <div class="flex items-center gap-3">
              <div class="w-10 h-10 rounded-xl bg-emerald-100 text-emerald-600 flex items-center justify-center">
                <i class="fa-solid fa-lock"></i>
              </div>
              <div>
                <p class="font-semibold text-slate-900">Secure processing active</p>
                <p class="text-xs text-slate-500">All systems running safely</p>
              </div>
            </div>
  
            <!-- Automated Security List -->
            <div class="space-y-3 text-sm text-slate-600">
              <p class="flex items-center gap-2">
                <i class="fa-solid fa-check text-emerald-500 text-xs"></i>
                Documents encrypted on upload
              </p>
              <p class="flex items-center gap-2">
                <i class="fa-solid fa-check text-emerald-500 text-xs"></i>
                HIPAA-compliant handling
              </p>
              <p class="flex items-center gap-2">
                <i class="fa-solid fa-check text-emerald-500 text-xs"></i>
                Private, isolated processing
              </p>
              <p class="flex items-center gap-2">
                <i class="fa-solid fa-check text-emerald-500 text-xs"></i>
                Secure summaries generated
              </p>
            </div>
  
            <!-- Subtle Prompt (Secondary) -->
            <div class="bg-slate-50 rounded-2xl p-5">
              <p class="text-xs font-medium text-slate-700 mb-3">
                Want something explained differently?
              </p>
              <div class="flex items-center gap-2">
                <input
                  type="text"
                  placeholder="Add a follow-up request‚Ä¶"
                  class="flex-1 text-xs px-3 py-2 rounded-lg border border-slate-200 bg-white"
                />
                <button class="w-10 h-10 rounded-xl bg-[#F59E0B] hover:bg-[#d97706] flex items-center justify-center transition">
                  <i class="fa-solid fa-arrow-up text-white text-xs"></i>
                </button>
              </div>
            </div>
  
          </div>
        </div>
  
        <!-- RIGHT: Trust Narrative -->
        <div class="order-1 lg:order-2 max-w-xl">
          <h2 class="text-4xl md:text-5xl font-bold tracking-tight text-slate-900 mb-6">
            Privacy isn‚Äôt optional.  
            It‚Äôs foundational.
          </h2>
  
          <p class="text-lg text-slate-600 leading-relaxed mb-8">
            Aira is built for medical information from the ground up ‚Äî with security,
            compliance, and privacy woven into every step.
          </p>
  
          <div class="space-y-5">
            <div class="flex items-start gap-4">
              <div class="w-9 h-9 rounded-xl bg-[#236092]/10 text-[#236092] flex items-center justify-center">
                <i class="fa-solid fa-shield-halved"></i>
              </div>
              <p class="text-slate-700 font-medium">
                End-to-end encrypted document handling
              </p>
            </div>
  
            <div class="flex items-start gap-4">
              <div class="w-9 h-9 rounded-xl bg-[#236092]/10 text-[#236092] flex items-center justify-center">
                <i class="fa-solid fa-file-shield"></i>
              </div>
              <p class="text-slate-700 font-medium">
                HIPAA-compliant processing by default
              </p>
            </div>
  
            <div class="flex items-start gap-4">
              <div class="w-9 h-9 rounded-xl bg-[#236092]/10 text-[#236092] flex items-center justify-center">
                <i class="fa-solid fa-user-shield"></i>
              </div>
              <p class="text-slate-700 font-medium">
                Your data stays yours ‚Äî always
              </p>
            </div>
          </div>
        </div>
  
      </div>
    </div>
  </section>
  

  <!-- Testimonials Section -->
  <section class="py-20 bg-white">
    <div class="max-w-7xl mx-auto px-4 md:px-6">
      <div class="text-center mb-12">
        <h2 class="text-5xl md:text-6xl font-bold tracking-tight text-slate-900 mb-4">
          NeuroMed Aira changed how I care for my family.
        </h2>
        <p class="text-lg text-slate-600 mb-6">
          Real people. Real clarity. Real relief.
        </p>
          </div>

      <!-- Testimonials Grid -->
      <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
        <!-- Testimonial 1 -->
        <div class="bg-white border border-slate-200 rounded-2xl p-6 shadow-sm hover:shadow-lg transition">
          <p class="text-sm text-slate-700 mb-4">
            "NeuroMed Aira looks perfect for caregivers who want to understand medical results without feeling overwhelmed."
          </p>
          <div class="flex items-center gap-3">
            <div class="w-10 h-10 rounded-full bg-[#236092] flex items-center justify-center text-white font-semibold">
              M
        </div>
            <div>
              <p class="font-semibold text-slate-900 text-sm">Maria Santos</p>
              <p class="text-xs text-slate-500">@marias_care</p>
            </div>
          </div>
        </div>

        <!-- Testimonial 2 -->
        <div class="bg-white border border-slate-200 rounded-2xl p-6 shadow-sm hover:shadow-lg transition">
          <p class="text-sm text-slate-700 mb-4">
            "You can finally understand complex medical reports without a medical degree. This tool just makes sense."
          </p>
          <div class="flex items-center gap-3">
            <div class="w-10 h-10 rounded-full bg-emerald-500 flex items-center justify-center text-white font-semibold">
              J
            </div>
            <div>
              <p class="font-semibold text-slate-900 text-sm">John Chen</p>
              <p class="text-xs text-slate-500">@johnhealth</p>
            </div>
          </div>
      </div>

        <!-- Testimonial 3 -->
        <div class="bg-white border border-slate-200 rounded-2xl p-6 shadow-sm hover:shadow-lg transition">
          <p class="text-sm text-slate-700 mb-4">
            "No jargon. No confusion. Just clear explanations when you need them most."
          </p>
          <div class="flex items-center gap-3">
            <div class="w-10 h-10 rounded-full bg-rose-500 flex items-center justify-center text-white font-semibold">
              S
      </div>
            <div>
              <p class="font-semibold text-slate-900 text-sm">Sarah Johnson</p>
              <p class="text-xs text-slate-500">@sarahcaregiver</p>
    </div>
  </div>
</div>

        <!-- Testimonial 4 -->
        <div class="bg-white border border-slate-200 rounded-2xl p-6 shadow-sm hover:shadow-lg transition">
          <p class="text-sm text-slate-700 mb-4">
            "Thoughtfully designed with patients in mind. Secure, accurate, and genuinely useful."
          </p>
          <div class="flex items-center gap-3">
            <div class="w-10 h-10 rounded-full bg-indigo-500 flex items-center justify-center text-white font-semibold">
              D
          </div>
            <div>
              <p class="font-semibold text-slate-900 text-sm">Dr. David Park</p>
              <p class="text-xs text-slate-500">@drpark</p>
            </div>
          </div>
        </div>

        <!-- Testimonial 5 -->
        <div class="bg-white border border-slate-200 rounded-2xl p-6 shadow-sm hover:shadow-lg transition">
          <p class="text-sm text-slate-700 mb-4">
            "Exactly what I needed to manage my parents' medical records with confidence."
          </p>
          <div class="flex items-center gap-3">
            <div class="w-10 h-10 rounded-full bg-amber-500 flex items-center justify-center text-white font-semibold">
              L
          </div>
            <div>
              <p class="font-semibold text-slate-900 text-sm">Lisa Martinez</p>
              <p class="text-xs text-slate-500">@lisafamily</p>
        </div>
          </div>
      </div>

        <!-- Testimonial 6 -->
        <div class="bg-white border border-slate-200 rounded-2xl p-6 shadow-sm hover:shadow-lg transition">
          <p class="text-sm text-slate-700 mb-4">
            "Fast answers, even late at night. This should exist everywhere."
          </p>
          <div class="flex items-center gap-3">
            <div class="w-10 h-10 rounded-full bg-teal-500 flex items-center justify-center text-white font-semibold">
              R
        </div>
            <div>
              <p class="font-semibold text-slate-900 text-sm">Robert Kim</p>
              <p class="text-xs text-slate-500">@robertkim</p>
        </div>
      </div>
        </div>
        </div>
      </div>
    </section>

  <!-- Pricing Section -->
  <section class="py-20 bg-gradient-to-b from-[#236092] via-[#1B5A8E] to-[#172554] text-white relative overflow-hidden">
    <div class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-emerald-400 to-teal-400"></div>
    <div class="max-w-7xl mx-auto px-4 md:px-6">
      <!-- Header -->
      <div class="text-center mb-12">
        <h2 class="text-5xl md:text-6xl font-bold tracking-tight mb-4">
          Plans for <span class="text-emerald-400">every need</span>
        </h2>
          <p class="text-lg text-white/80 max-w-3xl mx-auto">
          Start free. Upgrade when you're ready. Grow at your own pace.
        </p>
      </div>

      <!-- Pricing Cards Grid -->
      <div class="grid md:grid-cols-2 lg:grid-cols-4 gap-6">
        <!-- Free Plan -->
        <div class="bg-white/10 backdrop-blur-sm border border-white/20 rounded-3xl p-6 shadow-xl flex flex-col">
          <div class="mb-6">
            <h3 class="text-2xl font-bold mb-2">Free</h3>
            <p class="text-sm text-white/80 mb-4">See what AI clarity feels like</p>
            <div class="mb-4">
              <span class="text-4xl font-bold">$0</span>
              <span class="text-white/70">/month</span>
            </div>
          </div>
          <a href="/signup" class="block w-full text-center px-6 py-3 rounded-xl bg-white/20 hover:bg-white/30 text-white font-semibold transition mb-6 border border-white/30">
            Get Started
          </a>
          <ul class="space-y-3 flex-grow">
            <li class="flex items-start gap-2">
              <i class="fa-solid fa-check text-emerald-400 mt-0.5"></i>
              <span class="text-sm">Simple medical explanations</span>
            </li>
            <li class="flex items-start gap-2">
              <i class="fa-solid fa-check text-emerald-400 mt-0.5"></i>
              <span class="text-sm">Short chats for common questions</span>
            </li>
            <li class="flex items-start gap-2">
              <i class="fa-solid fa-check text-emerald-400 mt-0.5"></i>
              <span class="text-sm">Basic document summaries</span>
            </li>
            <li class="flex items-start gap-2">
              <i class="fa-solid fa-times text-red-400 mt-0.5"></i>
              <span class="text-sm text-white/60">Limited premium access</span>
            </li>
          </ul>
              </div>

        <!-- Monthly Plan -->
        <div class="bg-white/10 backdrop-blur-sm border-2 border-white/30 rounded-3xl p-6 shadow-xl flex flex-col relative">
          <div class="mb-6">
            <h3 class="text-2xl font-bold mb-2">Monthly</h3>
            <p class="text-sm text-white/80 mb-4">For ongoing peace of mind</p>
            <div class="mb-4">
              <span class="text-4xl font-bold">$20</span>
              <span class="text-white/70">/month</span>
            </div>
          </div>
          <a href="/signup" class="block w-full text-center px-6 py-3 rounded-xl bg-white text-[#236092] font-semibold hover:bg-slate-100 transition shadow-lg mb-6">
            Upgrade to Monthly
          </a>
          <ul class="space-y-3 flex-grow">
            <li class="flex items-start gap-2">
              <i class="fa-solid fa-check text-emerald-400 mt-0.5"></i>
              <span class="text-sm">Unlimited medical summaries</span>
            </li>
            <li class="flex items-start gap-2">
              <i class="fa-solid fa-check text-emerald-400 mt-0.5"></i>
              <span class="text-sm">Longer chats & larger uploads</span>
            </li>
            <li class="flex items-start gap-2">
              <i class="fa-solid fa-check text-emerald-400 mt-0.5"></i>
              <span class="text-sm">Voice interaction</span>
            </li>
            <li class="flex items-start gap-2">
              <i class="fa-solid fa-check text-emerald-400 mt-0.5"></i>
              <span class="text-sm">30-day chat history</span>
            </li>
            <li class="flex items-start gap-2">
              <i class="fa-solid fa-check text-emerald-400 mt-0.5"></i>
              <span class="text-sm">Priority support</span>
            </li>
          </ul>
              </div>

        <!-- Annual Plan -->
        <div class="bg-white/10 backdrop-blur-sm border-2 border-purple-400/50 rounded-3xl p-6 shadow-xl flex flex-col relative">
          <div class="absolute top-4 right-4 bg-purple-600 text-white text-xs font-semibold px-3 py-1 rounded-full">
            ‚≠ê Most Popular
              </div>
          <div class="mb-6">
            <h3 class="text-2xl font-bold mb-2">Annual</h3>
            <p class="text-sm text-white/80 mb-4">The best value for long-term care</p>
            <div class="mb-2">
              <span class="text-4xl font-bold">$199</span>
              <span class="text-white/70">/year</span>
            </div>
            <p class="text-xs text-emerald-400 font-medium">Save 17% compared to monthly</p>
          </div>
          <a href="/signup" class="block w-full text-center px-6 py-3 rounded-xl bg-purple-600 hover:bg-purple-700 text-white font-semibold transition shadow-lg mb-6">
            Get Annual
          </a>
          <ul class="space-y-3 flex-grow">
            <li class="flex items-start gap-2">
              <i class="fa-solid fa-check text-emerald-400 mt-0.5"></i>
              <span class="text-sm">Everything in Monthly</span>
            </li>
            <li class="flex items-start gap-2">
              <i class="fa-solid fa-check text-emerald-400 mt-0.5"></i>
              <span class="text-sm">365-day chat history</span>
            </li>
            <li class="flex items-start gap-2">
              <i class="fa-solid fa-check text-emerald-400 mt-0.5"></i>
              <span class="text-sm">Priority support</span>
            </li>
            <li class="flex items-start gap-2">
              <i class="fa-solid fa-check text-emerald-400 mt-0.5"></i>
              <span class="text-sm">Designed for continuous use</span>
            </li>
          </ul>
          </div>

        <!-- Enterprise Plan -->
        <div class="bg-white/10 backdrop-blur-sm border-2 border-emerald-400/50 rounded-3xl p-6 shadow-xl flex flex-col relative">
          <div class="mb-6">
            <h3 class="text-2xl font-bold mb-2">Enterprise</h3>
            <p class="text-sm text-white/80 mb-4">Build your own medical AI system</p>
            <div class="mb-2">
              <span class="text-4xl font-bold">Custom</span>
          </div>
            <p class="text-xs text-emerald-400 font-medium">pricing</p>
          </div>
          <a href="/signup" class="block w-full text-center px-6 py-3 rounded-xl border-2 border-emerald-400 text-emerald-400 hover:bg-emerald-400/10 font-semibold transition mb-6">
            Contact Us
          </a>
          <ul class="space-y-3 flex-grow">
            <li class="flex items-start gap-2">
              <i class="fa-solid fa-check text-emerald-400 mt-0.5"></i>
              <span class="text-sm">Everything in Annual</span>
            </li>
            <li class="flex items-start gap-2">
              <i class="fa-solid fa-check text-emerald-400 mt-0.5"></i>
              <span class="text-sm">Unlimited chat history</span>
            </li>
            <li class="flex items-start gap-2">
              <i class="fa-solid fa-check text-emerald-400 mt-0.5"></i>
              <span class="text-sm">Custom features & integrations</span>
            </li>
            <li class="flex items-start gap-2">
              <i class="fa-solid fa-check text-emerald-400 mt-0.5"></i>
              <span class="text-sm">Team access & audit logs</span>
            </li>
            <li class="flex items-start gap-2">
              <i class="fa-solid fa-check text-emerald-400 mt-0.5"></i>
              <span class="text-sm">Dedicated support</span>
            </li>
            <li class="flex items-start gap-2">
              <i class="fa-solid fa-check text-emerald-400 mt-0.5"></i>
              <span class="text-sm">Flexible contract terms</span>
            </li>
          </ul>
        </div>
        </div>
      </div>
    </section>

  <!-- Final CTA Section -->
  <section class="py-20 bg-gradient-to-b from-white via-slate-50 to-white">
    <div class="max-w-4xl mx-auto px-4 md:px-6 text-center">
      <h2 class="text-4xl md:text-5xl lg:text-6xl font-bold tracking-tight text-slate-900 mb-6">
        Start understanding in minutes.
      </h2>
      <p class="text-xl md:text-2xl text-slate-600 mb-8 max-w-2xl mx-auto">
        No jargon. No guessing. Just clarity‚Äîwhen it matters most.
      </p>
      <a href="/signup" class="inline-flex items-center px-8 py-4 rounded-xl bg-slate-900 text-white font-semibold hover:bg-slate-800 transition shadow-lg text-lg">
        Start building with NeuroMed Aira
      </a>
    </div>
  </section>

  <!-- Toast Notification -->
  <div id="toast" class="toast fixed top-4 right-4 z-[60] hidden">
    <div class="bg-white border shadow-lg rounded-xl px-4 py-3 text-sm flex items-center gap-2">
      <i id="toastIcon" class="fa-regular fa-message text-[#236092]" aria-hidden="true"></i>
      <span id="toastText" class="text-slate-800">Mode set</span>
    </div>
  </div>

  <!-- Post-result invite -->
  <div id="postResultInvite" class="fixed bottom-4 right-4 z-[60] hidden">
    <div class="bg-white border shadow-xl rounded-2xl p-5 max-w-sm">
      <div class="font-semibold text-slate-900">Like this summary?</div>
      <p class="text-sm text-slate-600 mt-2">Create a free account to keep your history and download PDFs.</p>
      <div class="mt-4 flex gap-2">
        <a href="/signup" class="px-4 py-2 rounded-lg bg-[#236092] text-white text-sm font-medium hover:bg-[#1B5A8E] transition">Create free account</a>
        <button class="px-4 py-2 rounded-lg border text-sm hover:bg-slate-50" onclick="document.getElementById('postResultInvite').classList.add('hidden')">Not now</button>
      </div>
    </div>
  </div>

  <script>
// Language Support
const LANGUAGE_CHOICES = [
  ['en-US','English'], ['ja-JP','Japanese'], ['es-ES','Spanish'], ['fr-FR','French'],
  ['de-DE','German'], ['it-IT','Italian'], ['pt-PT','Portuguese (Portugal)'], ['pt-BR','Portuguese (Brazil)'],
  ['ru-RU','Russian'], ['zh-CN','Chinese (Simplified)'], ['zh-TW','Chinese (Traditional)'], ['ko-KR','Korean'],
  ['ar-SA','Arabic'], ['tr-TR','Turkish'], ['nl-NL','Dutch'], ['sv-SE','Swedish'],
  ['pl-PL','Polish'], ['da-DK','Danish'], ['no-NO','Norwegian'], ['fi-FI','Finnish'],
  ['he-IL','Hebrew'], ['th-TH','Thai'], ['hi-IN','Hindi'], ['cs-CZ','Czech'],
  ['ro-RO','Romanian'], ['hu-HU','Hungarian'], ['sk-SK','Slovak'], ['bg-BG','Bulgarian'],
  ['uk-UA','Ukrainian'], ['vi-VN','Vietnamese'], ['id-ID','Indonesian'], ['ms-MY','Malay'],
  ['sr-RS','Serbian'], ['hr-HR','Croatian'], ['el-GR','Greek'], ['lt-LT','Lithuanian'],
  ['lv-LV','Latvian'], ['et-EE','Estonian'], ['sl-SI','Slovenian'], ['is-IS','Icelandic'],
  ['sq-AL','Albanian'], ['mk-MK','Macedonian'], ['bs-BA','Bosnian'], ['ca-ES','Catalan'],
  ['gl-ES','Galician'], ['eu-ES','Basque'], ['hy-AM','Armenian'], ['fa-IR','Persian'],
  ['sw-KE','Swahili'], ['ta-IN','Tamil'], ['te-IN','Telugu'], ['kn-IN','Kannada'],
  ['ml-IN','Malayalam'], ['mr-IN','Marathi'], ['pa-IN','Punjabi'], ['gu-IN','Gujarati'],
  ['or-IN','Odia'], ['as-IN','Assamese'], ['ne-NP','Nepali'], ['si-LK','Sinhala'],
];

function guessBrowserLang(){
  const nav = (navigator.languages && navigator.languages[0]) || navigator.language || 'en-US';
  return LANGUAGE_CHOICES.find(([code]) => code === nav) ? nav : 'en-US';
}
function loadLang(){ return localStorage.getItem('nm_lang') || guessBrowserLang(); }
function saveLang(code){ localStorage.setItem('nm_lang', code); }
function labelForLang(code){
  const found = LANGUAGE_CHOICES.find(([c])=>c===code);
  return found ? found[1] : code;
}
function buildLangMenu(menuEl, onPick){
  if (!menuEl) return;
  menuEl.innerHTML = '';
  LANGUAGE_CHOICES.forEach(([code, label]) => {
    const btn = document.createElement('button');
    btn.type = 'button';
    btn.className = 'w-full text-left px-3 py-2 hover:bg-slate-50 flex items-center gap-2';
    btn.dataset.lang = code;
    btn.innerHTML = `<span class="flex-1 truncate">${label}</span><span class="text-xs text-slate-500">${code}</span>`;
    btn.addEventListener('click', () => onPick(code));
    menuEl.appendChild(btn);
  });
}
function toggleMenu(el, open){
  if (!el) return;
  el.classList.toggle('hidden', !open);
}
function applyLangUI(code){
  const label = labelForLang(code);
  const b1 = document.getElementById('langBtnLabel');
  const b2 = document.getElementById('mLangBtnLabel');
  if (b1) b1.textContent = label;
  if (b2) b2.textContent = label;
}

// Utilities
    function getCSRFToken(){ const m=document.cookie.match('(^|;)\\s*csrftoken\\s*=\\s*([^;]+)'); return m?m.pop():''; }
    const $ = sel => document.querySelector(sel);
    const $$ = sel => Array.from(document.querySelectorAll(sel));
    function track(ev, data={}){ try{ navigator.sendBeacon('/api/track', new Blob([JSON.stringify({ ev, ...data })], {type:'application/json'})); }catch{} }

    function setSendDisabled(disabled){ $('#sendBtn').disabled = disabled; }
function loadMode(){ return localStorage.getItem('nm_mode') || 'PlainClinical'; } // Default to Balanced
    function saveMode(m){ localStorage.setItem('nm_mode', m); }

    async function isAuthenticated(){
      try{
        const r=await fetch('/api/auth/status/',{ credentials:'include' });
        if(!r.ok) return false; const j=await r.json(); return !!j.authenticated;
      }catch{ return false; }
    }

    let firstSendAttempted = false;
    let files = [];
    let abortController = null;
    let showGateAfterResponse = false;
    let guestTurnsUsed = parseInt(localStorage.getItem('nm_guest_turns') || '0', 10);

// Readability Controls
    (function(){
      const root = document.documentElement;
      const body = document.body;
      $('#fontMinus')?.addEventListener('click', () => {
    const curr = parseFloat(getComputedStyle(root).getPropertyValue('font-size')) || 16;
    root.style.setProperty('font-size', Math.max(14, curr - 1) + 'px');
      });
      $('#fontPlus')?.addEventListener('click', () => {
    const curr = parseFloat(getComputedStyle(root).getPropertyValue('font-size')) || 16;
        root.style.setProperty('font-size', Math.min(22, curr + 1) + 'px');
      });
      $('#highContrast')?.addEventListener('click', ()=> {
        body.classList.toggle('hc');
        $('#highContrast').setAttribute('aria-pressed', body.classList.contains('hc') ? 'true' : 'false');
      });
  $('#mFontMinus')?.addEventListener('click', () => {
    const curr = parseFloat(getComputedStyle(root).getPropertyValue('font-size')) || 16;
    root.style.setProperty('font-size', Math.max(14, curr - 1) + 'px');
  });
  $('#mFontPlus')?.addEventListener('click', () => {
    const curr = parseFloat(getComputedStyle(root).getPropertyValue('font-size')) || 16;
    root.style.setProperty('font-size', Math.min(22, curr + 1) + 'px');
  });
  $('#mHighContrast')?.addEventListener('click', ()=> {
    body.classList.toggle('hc');
    $('#mHighContrast').setAttribute('aria-pressed', body.classList.contains('hc') ? 'true' : 'false');
  });
})();

// Mode Selection
    const MODE_META = {
  'PlainClinical': { 
    icon: 'fa-regular fa-message', 
    color: 'text-[#236092]', 
    intro: "Hi there! You're in Balanced Mode. I can help you with clear explanations and add clinician notes when useful." 
  },
  'Caregiver': { 
    icon: 'fa-solid fa-hands-holding-child', 
    color: 'text-amber-700', 
    intro: "Hi there! You're in Caregiver Mode. I can guide you with gentle, practical steps to make caregiving easier." 
  },
  'Faith': { 
    icon: 'fa-solid fa-hands-praying', 
    color: 'text-indigo-700', 
    intro: "Hi there! You're in Faith Mode. I can support you with guidance and encouragement, rooted in faith and hope." 
  },
  'Clinical': { 
  icon: 'fa-solid fa-stethoscope', 
  color: 'text-slate-800', 
  intro: `# ü©∫ NeuroMed Aira ‚Äî Clinical Mode

Welcome to **Clinical Mode**. I'll process notes, labs, and reports with a structured, medical-first lens.

**Think:** SOAP format, focused differentials, and evidence-based clarity‚Äîminus the clutter.

### What I'll do
- üìù Organize findings into **Subjective, Objective, Assessment, Plan**.
- üî¨ **Flag key abnormalities** or patterns worth noting.
- üìä Provide **concise interpretations** to speed rounds and documentation.

Your expertise leads; I make the information faster, sharper, and more usable.

**Upload your first report to begin.**`
},
  'Geriatric': { 
    icon: 'fa-solid fa-person-cane', 
    color: 'text-[#28926D]', 
    intro: "Hi there! You're in Geriatric Mode. I can explain things in simpler steps with clarity, tailored for older adults." 
  },
  'EmotionalSupport': { 
    icon: 'fa-solid fa-heart', 
    color: 'text-rose-700', 
    intro: "Hi there! You're in Emotional Support Mode. I can be here with calm, validating support and gentle guidance whenever you need it." 
  }
};

function selectMode(btn, skipRefresh = false){
  $$('#modeSelectWrap button').forEach(b => { 
    b.setAttribute('aria-pressed','false');
  });
  btn.setAttribute('aria-pressed','true');
  const mode = btn.dataset.mode;
  const currentMode = loadMode();
  saveMode(mode);
  applyModeUI(mode);
  track('mode_chosen', { mode });
  // Only refresh if mode actually changed and user clicked (not on page load)
  if (!skipRefresh && mode !== currentMode) {
    setTimeout(() => {
      window.location.reload();
    }, 300); // Small delay to show the toast notification
  }
}

    function applyModeUI(mode){
  const meta = MODE_META[mode] || MODE_META['PlainClinical'];
      const intro = $('#intro');
intro.classList.add('shimmer');
setTimeout(() => {
    intro.innerHTML = '';
  const node = renderAssistantMarkdown(meta.intro || '');
    intro.appendChild(node);
  intro.classList.remove('shimmer');
}, 220);
  showToast(`${mode === 'PlainClinical' ? 'Balanced' : mode === 'EmotionalSupport' ? 'Emotional Support' : mode} mode applied`, meta.icon, meta.color);
      if (mode === 'Geriatric'){
        document.body.classList.add('easy-read');
      }
    }

    function showToast(text, icon, color){
      const t = $('#toast'); const ti = $('#toastIcon'); const tt = $('#toastText');
      ti.className = icon + ' ' + color; tt.textContent = text;
      t.classList.remove('hidden'); void t.offsetWidth; t.classList.add('show');
      clearTimeout(showToast._timer);
      showToast._timer = setTimeout(()=>{ t.classList.remove('show'); setTimeout(()=>t.classList.add('hidden'), 220); }, 1500);
    }

    function iconFor(name){
      const n = name.toLowerCase();
      if(n.endsWith('.pdf')) return 'fa-regular fa-file-pdf';
      if(n.endsWith('.doc')||n.endsWith('.docx')) return 'fa-regular fa-file-word';
      if(n.endsWith('.jpg')||n.endsWith('.jpeg')||n.endsWith('.png')||n.endsWith('.heic')||n.endsWith('.webp')) return 'fa-regular fa-file-image';
      return 'fa-regular fa-file';
    }

const MAX_FILES = 15;
    
    function addFile(file){
      if(!file) return;
      if(files.length >= MAX_FILES) {
        showToast(`Maximum ${MAX_FILES} files allowed`, 'fa-solid fa-exclamation-triangle', 'text-amber-600');
        return;
      }
      const isDuplicate = files.some(f => f.name === file.name && f.size === file.size);
      if(isDuplicate) {
        showToast('This file is already added', 'fa-solid fa-info-circle', 'text-blue-600');
        return;
      }
      files.push(file);
      const chip = document.createElement('span');
      chip.className = 'text-xs bg-slate-100 border rounded-full px-2 py-1 inline-flex items-center gap-1';
      chip.dataset.fileName = file.name;
      chip.dataset.fileSize = file.size;
      chip.innerHTML = `<i class="${iconFor(file.name)}"></i><span class="max-w-[12rem] truncate">${escapeHtml(file.name)}</span>`;
      const x = document.createElement('button'); 
      x.className='ml-1 text-slate-500 hover:text-slate-800'; 
      x.innerHTML='&times;'; 
      x.setAttribute('aria-label','Remove attachment');
      x.addEventListener('click', ()=>{ 
        files = files.filter(f => !(f.name === file.name && f.size === file.size));
        chip.remove(); 
        toggleSend(); 
      });
      chip.appendChild(x);
      $('#fileChips').appendChild(chip);
      toggleSend();
      track('file_upload_started', { count: files.length });
    }

    function escapeHtml(str){ return str.replace(/[&<>"']/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;','\'':'&#39;'}[c])); }

    function autosize(){
      const ta = $('#chatInput');
      ta.style.height = 'auto';
      ta.style.height = Math.min(200, ta.scrollHeight) + 'px';
    }

    function toggleSend(){
  const hasText = ($('#chatInput').value || '').trim().length > 0;
      const hasFile = files.length > 0;
      setSendDisabled(!(hasText || hasFile));
    }

function appendBubble({ message, isUser=false, timestamp=new Date() }) {
  const chatWindow = document.getElementById('chatWindow');
  const wrap = document.createElement('div');
  wrap.className = 'w-full flex mb-3';
  const bubble = document.createElement('div');
  bubble.className = `chat-bubble ${isUser ? 'chat-user' : 'chat-ai'}`;
  bubble.innerText = message;
  const meta = document.createElement('div');
  meta.className = 'text-[11px] text-slate-400 mt-1 ' + (isUser ? 'text-right ml-auto pr-1' : 'pl-1');
  meta.innerText = new Intl.DateTimeFormat((typeof __nmLang === 'function' ? __nmLang() : undefined),{ hour:'2-digit', minute:'2-digit' }).format(timestamp);
  const col = document.createElement('div');
  col.className = 'flex flex-col ' + (isUser ? 'items-end ml-auto' : 'items-start mr-auto');
  col.appendChild(bubble);
  col.appendChild(meta);
  wrap.appendChild(col);
  chatWindow.appendChild(wrap);
  chatWindow.scrollTop = chatWindow.scrollHeight;
}

function appendAttachmentBubble(fileList){
  const chatWindow = document.getElementById('chatWindow');
  const wrap = document.createElement('div');
  wrap.className = 'w-full flex mb-3';
  const bubble = document.createElement('div');
  bubble.className = 'chat-bubble chat-user';
  const grid = document.createElement('div');
  grid.className = 'grid grid-cols-2 gap-2';
  const isImg = f => (f.type?.startsWith('image/') || /\.(png|jpe?g|webp)$/i.test(f.name));
  fileList.forEach(f => {
    if (isImg(f)) {
      const url = URL.createObjectURL(f);
      const img = document.createElement('img');
      img.src = url;
      img.alt = f.name;
      img.className = 'max-w-[160px] max-h-[120px] rounded-lg object-cover border';
      img.onload = () => URL.revokeObjectURL(url);
      grid.appendChild(img);
    } else {
      const row = document.createElement('div');
      row.className = 'flex items-center gap-2 rounded-md border bg-white/90 px-2 py-1 text-sm';
      row.innerHTML = `<i class="${iconFor(f.name)}"></i><span class="truncate max-w-[180px]" title="${escapeHtml(f.name)}">${escapeHtml(f.name)}</span>`;
      grid.appendChild(row);
    }
  });
  const title = document.createElement('div');
  title.className = 'text-[13px] mb-1 opacity-90';
  title.textContent = fileList.length > 1 ? 'You sent attachments' : 'You sent an attachment';
  bubble.appendChild(title);
  bubble.appendChild(grid);
  const meta = document.createElement('div');
  meta.className = 'text-[11px] text-slate-300 mt-1 text-right ml-auto pr-1';
  meta.innerText = new Intl.DateTimeFormat((typeof __nmLang === 'function' ? __nmLang() : undefined),{ hour:'2-digit', minute:'2-digit' }).format(new Date());
  const col = document.createElement('div');
  col.className = 'flex flex-col items-end ml-auto';
  col.appendChild(bubble);
  col.appendChild(meta);
  wrap.appendChild(col);
  chatWindow.appendChild(wrap);
  chatWindow.scrollTop = chatWindow.scrollHeight;
    }

  function renderAssistantMarkdown(mdText){
  const normalized = (mdText ?? '')
    .trim()
    .replace(/\r\n/g, '\n')
    .replace(/[ \t]+\n/g, '\n')
    .replace(/\n{3,}/g, '\n\n')
    .replace(/\n\s*\n(?=\s*#{1,4}\s)/g, '\n')
    .replace(/\n\s*\n(?=\s*([-*] |\d+\. ))/g, '\n');
  const raw = marked.parse(normalized, {
    gfm: true,
    breaks: false,
    headerIds: false
  });
  const safe = DOMPurify.sanitize(raw, { USE_PROFILES: { html: true } });
  const container = document.createElement('div');
  container.className = 'md-prose';
  container.innerHTML = safe;
  container.querySelectorAll('p').forEach(p => { if (!p.textContent.trim()) p.remove(); });
  container.querySelectorAll('a[href]').forEach(a => {
    try {
      const url = new URL(a.getAttribute('href'), location.href);
      if (url.origin !== location.origin) a.target = '_blank', a.rel = 'noopener noreferrer';
    } catch {}
  });
  return container;
}

    async function sendChat(){
  const msg = ($('#chatInput').value || '').trim();
  const mode = loadMode();
  const lang = (typeof __nmLang === 'function' ? __nmLang() : (navigator.language || 'en-US'));
  if(!msg && files.length===0) return;

  if(!firstSendAttempted){
    firstSendAttempted = true;
    const authed = await isAuthenticated();
    if(!authed){ showGateAfterResponse = true; }
  }

  if (window.innerWidth < 768) {
    document.getElementById('intro')?.classList.add('hidden');
  }

  const filesToSend = [...files];
  if (msg) appendBubble({ message: msg, isUser:true });
  if (filesToSend.length){
    appendAttachmentBubble(filesToSend);
    $('#fileChips').innerHTML = '';
  }

  $('#chatInput').value=''; 
  autosize(); 
  toggleSend();

  const chatWindow = $('#chatWindow');
const typingWrap = document.createElement('div');
typingWrap.className = 'w-full flex mb-3';
const col = document.createElement('div');
col.className = 'flex flex-col items-start mr-auto';
const typing = document.createElement('div');
typing.className = 'chat-bubble chat-ai flex items-center gap-2 text-slate-600 bg-slate-100 px-3 py-2 rounded-2xl shadow-sm';
  typing.innerHTML = `<i class="fa-solid fa-spinner fa-spin text-slate-500"></i><span class="dotty">Thinking</span>`;
col.appendChild(typing);
typingWrap.appendChild(col);
chatWindow.appendChild(typingWrap);
chatWindow.scrollTop = chatWindow.scrollHeight;

  const fd = new FormData();
  if (msg) fd.append('message', msg);
  fd.append('tone', mode);
  fd.append('lang', lang);
  // Include session_id if available (for adaptive system profile tracking)
  const existingSessionId = localStorage.getItem('nm_session_id');
  if (existingSessionId) fd.append('session_id', existingSessionId);
  if (filesToSend.length) {
    for (const f of filesToSend) fd.append('files[]', f);
  }

  abortController = new AbortController();

  try{
    const res = await fetch('/webapp/api/send-chat/', { 
      method:'POST',
      headers:{ 
        'X-CSRFToken': getCSRFToken(),
        'Accept-Language': lang
      },
      body: fd,
      credentials:'include',
      signal: abortController.signal
    });
    const data = await res.json();
    // Store session_id if returned (for adaptive system profile tracking)
    if (data.session_id) localStorage.setItem('nm_session_id', data.session_id);
   typing.classList.remove('text-slate-600'); 
typing.classList.add('text-slate-800');
    typing.innerHTML = '';
const node = renderAssistantMarkdown(data.reply || '‚ö†Ô∏è No reply received.');
typing.appendChild(node);
    track('result_rendered', { mode, lang, hasFiles: filesToSend.length>0 });
  }catch(e){
    typing.classList.remove('text-slate-600'); 
    typing.classList.add('text-red-700','bg-red-100');
    typing.innerText = 'I couldn\'t finish that‚Äîwant me to try a lighter summary or split the file?';
  }finally{
    files = [];
    $('#fileChips').innerHTML='';
    toggleSend();

    if(showGateAfterResponse){
      const authed = await isAuthenticated();
      if(!authed){
        guestTurnsUsed += 1;
        localStorage.setItem('nm_guest_turns', String(guestTurnsUsed));
        if(guestTurnsUsed === 1) { $('#postResultInvite').classList.remove('hidden'); }
      }
      showGateAfterResponse=false;
    }
      }
    }

    function startDictation(){
  if(!('webkitSpeechRecognition' in window)){ alert('Speech recognition works best in Chrome.'); return; }
  const rec = new webkitSpeechRecognition();
  rec.lang = (typeof __nmLang === 'function' ? __nmLang() : 'en-US');
  rec.onresult = (e)=>{ $('#chatInput').value = e.results[0][0].transcript; autosize(); toggleSend(); };
  rec.start();
}

// Initialize
document.addEventListener('DOMContentLoaded', () => {
  // Language
  const desktopBtn = $('#langBtn');
  const desktopMenu = $('#langMenu');
  const mobileBtn = $('#mLangBtn');
  const mobileMenu = $('#mLangMenu');
  const current = loadLang();
  applyLangUI(current);
  buildLangMenu(desktopMenu, pickLang);
  buildLangMenu(mobileMenu, pickLang);
  function pickLang(code){
    saveLang(code);
    applyLangUI(code);
    toggleMenu(desktopMenu, false);
    toggleMenu(mobileMenu, false);
  }
  desktopBtn?.addEventListener('click', (e) => {
    e.stopPropagation();
    const isOpen = desktopMenu && !desktopMenu.classList.contains('hidden');
    toggleMenu(desktopMenu, !isOpen);
  });
  mobileBtn?.addEventListener('click', (e) => {
    e.stopPropagation();
    const isOpen = mobileMenu && !mobileMenu.classList.contains('hidden');
    toggleMenu(mobileMenu, !isOpen);
  });
  document.addEventListener('click', (e) => {
    if (desktopMenu && !desktopMenu.contains(e.target) && e.target !== desktopBtn) toggleMenu(desktopMenu, false);
    if (mobileMenu && !mobileMenu.contains(e.target) && e.target !== mobileBtn) toggleMenu(mobileMenu, false);
  });
  document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape'){ toggleMenu(desktopMenu, false); toggleMenu(mobileMenu, false); }
  });
  window.__nmLang = () => loadLang();

  // Mode buttons
  const savedMode = loadMode();
  $$('#modeSelectWrap button').forEach(btn => {
    const mode = btn.dataset.mode;
    if(mode === savedMode){ selectMode(btn, true); } // skipRefresh=true on page load
    btn.addEventListener('click', () => selectMode(btn, false)); // Allow refresh on user click
  });

  // Suggestions
  $$('.suggestion-chip').forEach(btn => btn.addEventListener('click', () => {
    $('#chatInput').value = btn.querySelector('span').textContent.trim(); 
    autosize(); 
    toggleSend(); 
    $('#chatInput').focus();
  }));

  // Input events
  $('#chatInput').addEventListener('input', () => { autosize(); toggleSend(); });
  $('#chatInput').addEventListener('keydown', (e) => { 
    if(e.key === 'Enter' && !e.shiftKey){ 
      e.preventDefault(); 
      sendChat(); 
    }
  });
  $('#sendBtn').addEventListener('click', sendChat);

  // Upload
  $('#uploadBtn').addEventListener('click', () => $('#fileInput').click());
  $('#fileInput').addEventListener('change', (e) => { 
    if(e.target.files?.length){ 
      for(const f of e.target.files){ addFile(f); } 
      e.target.value=''; 
    } 
  });

  // Drag & drop
  const dz = $('#chatInput').parentElement;
  ['dragenter','dragover'].forEach(evt => dz.addEventListener(evt, (e)=>{ e.preventDefault(); }));
  ['dragleave','drop'].forEach(evt => dz.addEventListener(evt, (e)=>{ 
    e.preventDefault(); 
    if(evt==='drop'){ 
      const dt=e.dataTransfer; 
      if(dt?.files?.length){ 
        for(const f of dt.files){ addFile(f); } 
      } 
    } 
  }));

  // Paste
  document.addEventListener('paste', (e)=>{ 
    const items=e.clipboardData?.items || []; 
    for(const it of items){ 
      if(it.kind==='file'){ addFile(it.getAsFile()); } 
    } 
  });

  // Mic
  $('#micBtn').addEventListener('click', startDictation);

  autosize(); 
  toggleSend();
  setTimeout(()=>$('#chatInput').focus(), 200);

  // Mobile menu
  const btn = $('#nmMenuBtn');
  const menu = $('#nmMobileMenu');
  const icoOpen = $('#nmIconOpen');
  const icoClose = $('#nmIconClose');
  function setOpen(isOpen){
    menu.classList.toggle('hidden', !isOpen);
    btn.setAttribute('aria-expanded', String(isOpen));
    icoOpen.classList.toggle('hidden', isOpen);
    icoClose.classList.toggle('hidden', !isOpen);
  }
  btn?.addEventListener('click', () => setOpen(menu.classList.contains('hidden')));
  document.addEventListener('click', (e) => {
    if (!menu || menu.classList.contains('hidden')) return;
    const within = menu.contains(e.target) || btn.contains(e.target);
    if (!within) setOpen(false);
  });
  document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape') setOpen(false);
  });
});
</script>

<script>
    if ("serviceWorker" in navigator) {
      window.addEventListener("load", () => {
        navigator.serviceWorker.register("/sw.js").catch(console.warn);
      });
    }
</script>


  <!-- Footer -->
  <footer class="max-w-4xl mx-auto px-4 md:px-5 py-8 mt-12 border-t border-slate-200">
      <div class="flex flex-wrap items-center justify-center gap-4 text-sm">
      <a href="{% url 'privacy' %}" class="text-[#236092] hover:text-[#1B5A8E] font-medium underline">Privacy Policy</a>
        <span class="text-slate-400">‚Ä¢</span>
      <a href="{% url 'terms' %}" class="text-[#236092] hover:text-[#1B5A8E] font-medium underline">Terms of Use</a>
        <span class="text-slate-400">‚Ä¢</span>
      <a href="/about" class="text-slate-600 hover:text-slate-900">About</a>
      </div>
    <div class="text-center text-xs text-slate-500 mt-4">
        ¬© 2025 NeuroMed Aira. All rights reserved.
    </div>
  </footer>

</body>
</html>
